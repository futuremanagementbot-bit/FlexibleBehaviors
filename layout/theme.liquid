<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- SEO -->
  <title>{{ page_title | default: 'Flexible Behaviors — Affordable Special Needs Tools' }}</title>
  <meta name="description" content="{{ page_description | default: 'Affordable, practical tools for parents and providers supporting individuals with special needs. Visual supports, token boards, sensory tools, and more.' }}">
  <link rel="canonical" href="{{ canonical_url }}">

  <!-- Open Graph -->
  <meta property="og:title" content="{{ page_title }}">
  <meta property="og:description" content="{{ page_description }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ canonical_url }}">
  {% if page_image %}
  <meta property="og:image" content="{{ page_image | image_url }}">
  {% endif %}

  <!-- Favicon -->
  {% if settings.favicon %}
  <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32 }}">
  {% endif %}

  <!-- Fonts: Nunito (400, 600, 700) + Lora (400 Italic) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Lora:ital@1&display=swap" rel="stylesheet">

  <!-- Theme CSS -->
  {{ 'flexible-behaviors.css' | asset_url | stylesheet_tag }}

  <!-- Shopify required -->
  {{ content_for_header }}
</head>

<body>
  <!-- Skip to content — Accessibility -->
  <a class="skip-to-content" href="#main-content">Skip to content</a>

  <!-- Announcement Bar -->
  {% section 'announcement-bar' %}

  <!-- Header / Navigation -->
  {% section 'header' %}

  <!-- Mobile Navigation Drawer -->
  <div class="mobile-nav__overlay" id="mobile-nav-overlay" aria-hidden="true"></div>
  <nav class="mobile-nav" id="mobile-nav" aria-label="Mobile navigation" role="navigation">
    <button class="mobile-nav__close" id="mobile-nav-close" aria-label="Close menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
    <ul class="mobile-nav__list">
      <li><a class="mobile-nav__link" href="/collections">Shop</a></li>
      <li><a class="mobile-nav__link" href="/collections/visual-supports-printables">Visual Supports & Printables</a></li>
      <li><a class="mobile-nav__link" href="/collections/token-boards-reinforcement">Token Boards & Reinforcement</a></li>
      <li><a class="mobile-nav__link" href="/collections/sensory-tools-fidgets">Sensory Tools & Fidgets</a></li>
      <li><a class="mobile-nav__link" href="/collections/data-collection-provider-tools">Provider Tools</a></li>
      <li><a class="mobile-nav__link" href="/collections/kits-bundles">Kits & Bundles</a></li>
      <li><a class="mobile-nav__link" href="/pages/about">About</a></li>
      <li><a class="mobile-nav__link" href="/blogs/resources">Blog</a></li>
      <li><a class="mobile-nav__link" href="/pages/faq">FAQ</a></li>
      <li><a class="mobile-nav__link" href="/pages/contact">Contact</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main id="main-content" role="main">
    {{ content_for_layout }}
  </main>

  <!-- Footer -->
  {% section 'footer' %}

  <!-- Scroll Animation Observer -->
  <script>
    (function() {
      // Fade-in-up scroll animation with IntersectionObserver
      var prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (!prefersReducedMotion && 'IntersectionObserver' in window) {
        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target); // Only animate once
            }
          });
        }, {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        });

        document.querySelectorAll('.fade-in-up').forEach(function(el) {
          observer.observe(el);
        });
      } else {
        // If reduced motion or no IntersectionObserver, show everything
        document.querySelectorAll('.fade-in-up').forEach(function(el) {
          el.classList.add('is-visible');
        });
      }

      // Mobile Navigation
      var menuToggle = document.getElementById('mobile-menu-toggle');
      var mobileNav = document.getElementById('mobile-nav');
      var mobileOverlay = document.getElementById('mobile-nav-overlay');
      var mobileClose = document.getElementById('mobile-nav-close');

      function openMobileNav() {
        mobileNav.classList.add('is-open');
        mobileOverlay.classList.add('is-open');
        mobileOverlay.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
      }

      function closeMobileNav() {
        mobileNav.classList.remove('is-open');
        mobileOverlay.classList.remove('is-open');
        mobileOverlay.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      if (menuToggle) menuToggle.addEventListener('click', openMobileNav);
      if (mobileClose) mobileClose.addEventListener('click', closeMobileNav);
      if (mobileOverlay) mobileOverlay.addEventListener('click', closeMobileNav);

      // Close mobile nav on Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileNav.classList.contains('is-open')) {
          closeMobileNav();
          menuToggle.focus();
        }
      });

      // Announcement bar dismiss
      var announcementClose = document.querySelector('.announcement-bar__close');
      if (announcementClose) {
        announcementClose.addEventListener('click', function() {
          var bar = document.querySelector('.announcement-bar');
          if (bar) bar.style.display = 'none';
        });
      }

      // FAQ Accordion
      document.querySelectorAll('.accordion__trigger').forEach(function(trigger) {
        trigger.addEventListener('click', function() {
          var item = this.closest('.accordion__item');
          var content = item.querySelector('.accordion__content');
          var isOpen = item.hasAttribute('open');

          if (isOpen) {
            item.removeAttribute('open');
            content.style.maxHeight = null;
            this.setAttribute('aria-expanded', 'false');
          } else {
            item.setAttribute('open', '');
            content.style.maxHeight = content.scrollHeight + 'px';
            this.setAttribute('aria-expanded', 'true');
          }
        });
      });
    })();
  </script>
</body>
</html>
