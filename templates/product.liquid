<!-- Product Page Template -->
<section class="section section--cream">
  <div class="container">
    <div class="about-split" style="gap: var(--space-xl);">

      <!-- Product Images -->
      <div class="fade-in-up">
        <div style="border-radius: var(--radius-lg); overflow: hidden; background: var(--color-soft-white); box-shadow: var(--shadow-sm);">
          {%- if product.featured_image -%}
            <img
              src="{{ product.featured_image | image_url: width: 800 }}"
              alt="{{ product.featured_image.alt | default: product.title | escape }}"
              width="800"
              height="800"
              style="width: 100%; aspect-ratio: 1/1; object-fit: cover;"
              loading="eager"
              id="product-main-image"
            >
          {%- else -%}
            <div class="skeleton skeleton--image"></div>
          {%- endif -%}
        </div>

        {%- if product.images.size > 1 -%}
          <div style="display: flex; gap: var(--space-xs); margin-top: var(--space-sm); overflow-x: auto;">
            {%- for image in product.images -%}
              <button
                type="button"
                style="flex-shrink: 0; width: 80px; height: 80px; border-radius: var(--radius-sm); overflow: hidden; border: 2px solid {% if forloop.first %}var(--color-deep-forest){% else %}transparent{% endif %}; cursor: pointer; background: none; padding: 0; transition: border-color var(--transition-fast);"
                aria-label="View image {{ forloop.index }} of {{ product.images.size }}"
                onclick="document.getElementById('product-main-image').src='{{ image | image_url: width: 800 }}'; this.parentElement.querySelectorAll('button').forEach(b => b.style.borderColor='transparent'); this.style.borderColor='var(--color-deep-forest)';"
              >
                <img
                  src="{{ image | image_url: width: 160 }}"
                  alt="{{ image.alt | default: product.title | escape }}"
                  width="80"
                  height="80"
                  style="width: 100%; height: 100%; object-fit: cover;"
                  loading="lazy"
                >
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

      <!-- Product Info -->
      <div class="fade-in-up" data-delay="2">
        <h1 style="margin-bottom: var(--space-xs);">{{ product.title }}</h1>

        <!-- Price -->
        <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-deep-forest); margin-bottom: var(--space-md);">
          {{ product.price | money }}
          {%- if product.compare_at_price > product.price -%}
            <span class="product-card__price--compare" style="font-size: 1.125rem;">{{ product.compare_at_price | money }}</span>
            <span style="display: inline-block; background: var(--color-terracotta); color: var(--color-cream); padding: 0.15rem 0.5rem; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 700; margin-left: 0.5rem; vertical-align: middle;">
              Save {{ product.compare_at_price | minus: product.price | money }}
            </span>
          {%- endif -%}
        </div>

        <!-- Product Form -->
        {%- form 'product', product -%}
          {%- if product.variants.size > 1 -%}
            <div class="form-group mb-md">
              <label for="product-variant" class="form-label">Options</label>
              <select id="product-variant" name="id" class="form-input" autocomplete="off">
                {%- for variant in product.variants -%}
                  <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }} â€” {{ variant.price | money }}
                    {%- unless variant.available %} (Sold out){% endunless -%}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          {%- else -%}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {%- endif -%}

          <!-- Quantity -->
          <div class="form-group mb-md">
            <label for="product-quantity" class="form-label">Quantity</label>
            <div style="display: flex; align-items: center; gap: 0;">
              <button type="button" class="btn btn-secondary btn-sm" style="border-radius: var(--radius-sm) 0 0 var(--radius-sm); padding: 0.5rem;" aria-label="Decrease quantity" onclick="var q=document.getElementById('product-quantity'); if(q.value>1) q.value=parseInt(q.value)-1;">
                {% render 'icon', name: 'minus' %}
              </button>
              <input
                type="number"
                id="product-quantity"
                name="quantity"
                value="1"
                min="1"
                max="99"
                class="form-input"
                style="width: 60px; text-align: center; border-radius: 0; border-left: none; border-right: none;"
                autocomplete="off"
                aria-label="Product quantity"
              >
              <button type="button" class="btn btn-secondary btn-sm" style="border-radius: 0 var(--radius-sm) var(--radius-sm) 0; padding: 0.5rem;" aria-label="Increase quantity" onclick="var q=document.getElementById('product-quantity'); if(q.value<99) q.value=parseInt(q.value)+1;">
                {% render 'icon', name: 'plus' %}
              </button>
            </div>
          </div>

          <!-- Add to Cart -->
          <button
            type="submit"
            class="btn btn-cta"
            style="width: 100%; font-size: 1.0625rem; padding: 1rem;"
            {% unless product.available %}disabled{% endunless %}
          >
            {%- if product.available -%}
              Add to Toolkit
            {%- else -%}
              Sold Out
            {%- endif -%}
          </button>
        {%- endform -%}

        <!-- Product Description -->
        {%- if product.description != blank -%}
          <div style="margin-top: var(--space-lg); line-height: 1.7;">
            {{ product.description }}
          </div>
        {%- endif -%}
      </div>

    </div>

    <!-- Related Products -->
    {%- if collection and collection.products.size > 1 -%}
      <div style="margin-top: var(--space-2xl);">
        {% render 'section-header', title: 'You Might Also Like' %}
        <div class="product-grid">
          {%- for related_product in collection.products limit: 4 -%}
            {%- unless related_product.id == product.id -%}
              {% render 'product-card', product: related_product, delay: forloop.index %}
            {%- endunless -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

  </div>
</section>
